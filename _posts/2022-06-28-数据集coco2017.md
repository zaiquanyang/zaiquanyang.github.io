---
layout: post
title: ç›®æ ‡æ£€æµ‹æ•°æ®é›†-COCO2017
tags: æ•°æ®é›†
---

## ğŸ‰ COCO2017æ•°æ®é›†ç®€ä»‹

MSCOCO æ•°æ®é›†æ˜¯å¾®è½¯æ„å»ºçš„ä¸€ä¸ªæ•°æ®é›†ï¼Œå…¶åŒ…å« detection, segmentation, keypointsç­‰ä»»åŠ¡, æ˜¯ç›®æ ‡æ£€æµ‹æ•°æ®é›†ä¸­ä¸»æµçš„æ•°æ®é›†ä¹‹ä¸€ã€‚

ä¸PASCAL COCOæ•°æ®é›†ç›¸æ¯”ï¼ŒCOCOä¸­çš„å›¾ç‰‡åŒ…å«äº†è‡ªç„¶å›¾ç‰‡ä»¥åŠç”Ÿæ´»ä¸­å¸¸è§çš„ç›®æ ‡å›¾ç‰‡ï¼ŒèƒŒæ™¯æ¯”è¾ƒå¤æ‚ï¼Œ**ç›®æ ‡æ•°é‡æ¯”è¾ƒå¤š**ï¼Œ**ç›®æ ‡å°ºå¯¸æ›´å°**ï¼Œå› æ­¤COCOæ•°æ®é›†ä¸Šçš„ä»»åŠ¡ä¹Ÿæ›´éš¾ï¼Œå½“å‰è¯„ä»·ä¸€ä¸ªæ£€æµ‹æ¨¡å‹å¥½åä¸€èˆ¬ä½¿ç”¨COCOæ•°æ®é›†ã€‚

---


### ğŸ‰ æ•°æ®é›†ä¸‹è½½

[COCOæ•°æ®é›†è®ºæ–‡](https://arxiv.org/pdf/1405.0312.pdf)

[â¡ï¸cocoæ•°æ®é›†å®˜ç½‘](https://cocodataset.org/#download)

[ğŸ”„è®­ç»ƒé›†ä¸‹è½½é“¾æ¥ 118k/18GB](http://images.cocodataset.org/zips/train2017.zip)

[ğŸ”„éªŒè¯é›†ä¸‹è½½é“¾æ¥ 5k/1GB](http://images.cocodataset.org/zips/val2017.zip )

[ğŸ”„æµ‹è¯•é›†ä¸‹è½½é“¾æ¥ 41K/6GB](http://images.cocodataset.org/zips/test2017.zip )

[ğŸ”„æ•°æ®é›†stuffæ ‡æ³¨ä¸‹è½½é“¾æ¥](http://images.cocodataset.org/annotations/stuff_annotations_trainval2017.zip)

ä»€ä¹ˆæ˜¯stuffç±»åˆ« â“
- ç®€å•çš„ç†è§£å°±æ˜¯stuffä¸­åŒ…å«æ²¡æœ‰æ˜ç¡®è¾¹ç•Œçš„ææ–™å’Œå¯¹è±¡.

---
### ğŸ‰ æ•°æ®é›†ç±»åˆ«ä¿¡æ¯ä¸æ ‡æ³¨æ–‡ä»¶æ ¼å¼

#### ğŸ‰ç±»åˆ«ä¿¡æ¯

**éœ€è¦å¼ºè°ƒçš„COCOç›®æ ‡æ£€æµ‹æ•°æ®é›†æ˜¯80ä¸ªç±»åˆ«ï¼Œä½†æ˜¯ç±»åˆ«IDæœ€å¤§æ˜¾ç¤ºä¸º90ï¼Œæœ€å°ä¸º1, ä¸åŒ…æ‹¬Background.**

objectçš„80ç±»ä¸stuffä¸­çš„91ç±»çš„åŒºåˆ«åœ¨å“ª â“
- ç®€å•çš„ç†è§£å°±æ˜¯object80ç±»æ˜¯stuff91ç±»çš„å­é›†ã€‚å¯¹äºæˆ‘ä»¬è‡ªå·±ä½¿ç”¨ï¼Œå¦‚æœä»…ä»…æ˜¯åšç›®æ ‡æ£€æµ‹ï¼ŒåŸºæœ¬åªç”¨object80ç±»å³å¯ã€‚

æ¯ä¸ªç±»åˆ«å¯¹åº”çš„å®ä¾‹ä¸ªæ•°åˆ†å¸ƒå›¾å¦‚ä¸‹ï¼š

<img src="http://tva1.sinaimg.cn/large/007d2DYjly1h3ocnnmdb1j31dc0b67c5.jpg"/>

#### ğŸ‰ æ ‡æ³¨æ–‡ä»¶æ ¼å¼

ä»¥ `instances_train2017`æ ‡æ³¨æ–‡ä»¶ä¸ºä¾‹ï¼š

```python
import json

annotation_file = '/data/code/Det_Code/COCO_2017/annotations/instances_train2017.json'
with open(annotation_file, 'r') as f:
    dataset = json.load(f)
```

è¯»å–å, å¾—åˆ°ä¸€ä¸ªåŒ…å«å››ä¸ªkey: ['info', 'licenses', 'images', 'annotations', 'categories']çš„å­—å…¸ã€‚

**annotations**ï¼šæ˜¯ä¸€ä¸ªåˆ—è¡¨å¯¹åº”å…¨éƒ¨å®ä¾‹è€Œä¸æ˜¯å›¾åƒçš„æ ‡æ³¨ä¿¡æ¯ï¼Œä»¥ç¬¬ä¸€ä¸ªå›¾åƒå®ä¾‹ä¸ºä¾‹æ¥è¯´ï¼š

```markdown
{'segmentation': [[239.97, 260.24, 222.04, 270.49, 199.84, 253.41, 213.5, 227.79, 259.62, 200.46, 274.13, 202.17, 277.55, 210.71, 249.37, 253.41, 237.41, 264.51, 242.54, 261.95, 228.87, 271.34]], 'area': 2765.1486500000005, 'iscrowd': 0, 'image_id': 558840, 'bbox': [199.84, 200.46, 77.71, 70.88], 'category_id': 58, 'id': 156}
```

æ¯ä¸ªkeyåˆ†åˆ«å¯¹åº”ï¼šç›®æ ‡çš„åˆ†å‰²ä¿¡æ¯ï¼ˆpolygonså¤šè¾¹å½¢ï¼‰ï¼ˆsegmentationï¼‰ï¼Œå®ä¾‹é¢ç§¯ï¼ˆareaï¼‰ï¼Œç›®æ ‡è¾¹ç•Œæ¡†ä¿¡æ¯ï¼ˆå·¦ä¸Šè§’x,yåæ ‡ï¼Œä»¥åŠå®½é«˜ï¼‰ï¼ˆbboxï¼‰ï¼Œç±»åˆ«idï¼ˆcategory_idï¼‰ã€‚

**categories**ï¼šæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼ˆå…ƒç´ ä¸ªæ•°å¯¹åº”æ£€æµ‹ç›®æ ‡çš„ç±»åˆ«æ•°ï¼‰åˆ—è¡¨ä¸­æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªdictå¯¹åº”ä¸€ä¸ªç±»åˆ«çš„ç›®æ ‡ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç±»åˆ«idã€ç±»åˆ«åç§°å’Œæ‰€å±è¶…ç±»ï¼Œæ³¨æ„å®é™…åªæœ‰80ä¸ªObjectç±»ã€‚

**images**ï¼šæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼ˆå…ƒç´ ä¸ªæ•°å¯¹åº”å›¾åƒçš„å¼ æ•°ï¼‰ï¼Œåˆ—è¡¨ä¸­æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªdictï¼Œå¯¹åº”ä¸€å¼ å›¾ç‰‡çš„ç›¸å…³ä¿¡æ¯ã€‚åŒ…æ‹¬å¯¹åº”å›¾åƒåç§°ã€å›¾åƒå®½åº¦ã€é«˜åº¦ç­‰ä¿¡æ¯ã€‚
```markdown
{'license': 3, 'file_name': '000000391895.jpg', 'coco_url': 'http://images.cocodataset.org/train2017/000000391895.jpg', 'height': 360, 'width': 640, 'date_captured': '2013-11-14 11:18:45', 'flickr_url': 'http://farm9.staticflickr.com/8186/8119368305_4e622c8349_z.jpg', 'id': 391895}
```
æ¯ä¸ªkeyåˆ†åˆ«å¯¹åº”ï¼Œæ–‡ä»¶å/file_nameï¼Œé«˜åº¦/heightï¼Œå®½åº¦/width

---

#### ğŸ‰  å®˜æ–¹cocoAPIæŸ¥çœ‹æ•°æ®
å®˜æ–¹æœ‰ç»™å‡ºä¸€ä¸ªè¯»å–MS COCOæ•°æ®é›†ä¿¡æ¯çš„API, è¿™ä¸ªAPIå…·æœ‰æ•°æ®çš„è¯»å–ç­‰é‡è¦åŠŸèƒ½ã€‚
```shell
pip install pycocotools  
```
**ä½¿ç”¨`pycocotools` å¯è§†åŒ–å®ä¾‹è¾¹ç•Œæ¡†**

```python
import os
from pycocotools.coco import COCO
from PIL import Image, ImageDraw, ImageFont
import matplotlib.pyplot as plt

json_path = "/data/code/Det_Code/COCO_2017/annotations/instances_val2017.json"  # å›¾åƒæ³¨é‡Šæ–‡ä»¶è·¯å¾„
img_path = "/data/code/Det_Code/COCO_2017/val2017"   # å›¾åƒæ–‡ä»¶è·¯å¾„

# COCOæ˜¯ å®˜æ–¹APIä¸­åŠ è½½æ³¨é‡Šæ–‡ä»¶çš„ ç±»
coco = COCO(annotation_file=json_path)

# è·å–æ³¨é‡Šæ–‡ä»¶ä¸­çš„imageså…¨éƒ¨ç›¸å…³ä¿¡æ¯
ids = list(sorted(coco.imgs.keys()))
print("number of images: {}".format(len(ids)))

# get all coco class labels
coco_classes = dict([(v["id"], v["name"]) for k, v in coco.cats.items()])

# éå†å‰ä¸¤å¼ å›¾åƒ
for img_id in ids[:2]:
    # è·å–å¯¹åº”å›¾åƒidçš„æ‰€æœ‰annotations idxä¿¡æ¯
    ann_ids = coco.getAnnIds(imgIds=img_id)

    # æ ¹æ®annotations idxä¿¡æ¯è·å–æ‰€æœ‰æ ‡æ³¨ä¿¡æ¯
    targets = coco.loadAnns(ann_ids)

    # get image file name
    path = coco.loadImgs(img_id)[0]['file_name']

    # read image
    img = Image.open(os.path.join(img_path, path)).convert('RGB')
    draw = ImageDraw.Draw(img)
    # draw box to image
    for target in targets:
        x, y, w, h = target["bbox"]
        x1, y1, x2, y2 = x, y, int(x + w), int(y + h)
        draw.rectangle((x1, y1, x2, y2))
        draw.text((x1, y1), coco_classes[target["category_id"]])

    # show image
    plt.imshow(img)
    plt.savefig('example_{}.png'.format(img_id), dpi=50)
    plt.show()
```

<div align=center><img src="http://tva1.sinaimg.cn/large/007d2DYjly1h3of4pm0a8j30p00gotjy.jpg" width="488"></div>
<div align=center><img src="http://tva1.sinaimg.cn/large/007d2DYjly1h3of5r1nanj30p00go13a.jpg" width="488"></div>


è¿™é‡Œéœ€è¦å‚è€ƒ[csdnåšå®¢](https://blog.csdn.net/qq_37541097/article/details/113247318)ç»™å‡ºçš„ä»£ç ï¼Œé‡Œé¢è°ƒç”¨äº†APIä¸­çš„ä¸å°‘å‡½æ•°ï¼Œè¿˜éœ€è¦è¿›ä¸€æ­¥å­¦ä¹ ã€‚


**ä½¿ç”¨`pycocotools` å¯è§†åŒ–å®ä¾‹åˆ†å‰²mask**

è¿™é‡Œä¾æ—§å¯ä»¥å‚è€ƒ[csdnåšå®¢](https://blog.csdn.net/qq_37541097/article/details/113247318)ï¼Œè¿™é‡Œå°±ä¸æ”¾äº†ã€‚

---

#### ğŸ‰ è¯„ä¼°æ ‡å‡†

**mAP**

PASCAL ä¸­åœ¨æµ‹è¯•mAPæ—¶ï¼Œæ˜¯åœ¨IOU=0.5æ—¶æµ‹çš„ï¼Œè€ŒCOCOçš„ä¸»è¦è¯„ä»·æŒ‡æ ‡æ˜¯APï¼ŒæŒ‡ IOUä»0.5åˆ°0.95 æ¯å˜åŒ– 0.05 å°±æµ‹è¯•ä¸€æ¬¡ APï¼Œç„¶åæ±‚è¿™10æ¬¡æµ‹é‡ç»“æœçš„å¹³å‡å€¼ä½œä¸ºæœ€ç»ˆçš„ APï¼Œä¹Ÿå°±æ˜¯è¯´COCOè¯„ä»·æŒ‡æ ‡çš„ AP@0.5 è·ŸPASCAL VOCä¸­çš„mAPæ˜¯ç›¸åŒçš„å«ä¹‰ï¼ŒAP@0.75 è·ŸPASCAL VOCä¸­çš„mAPä¹Ÿç›¸åŒï¼Œåªæ˜¯IOUé˜ˆå€¼æé«˜åˆ°äº†0.75ï¼Œæ˜¾ç„¶è¿™ä¸ªè¦æ±‚çš„å‡†ç¡®åº¦æ›´é«˜ï¼Œç²¾åº¦ä¹Ÿä¼šæ›´ä½ã€‚

IOUè¶Šé«˜ï¼ŒAPå°±è¶Šä½ï¼Œæ‰€ä»¥æœ€ç»ˆçš„å¹³å‡ä¹‹åçš„APè¦æ¯” AP@0.5 å°å¾ˆå¤šï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆCOCOçš„AP è¶…è¿‡ 50%çš„åªæœ‰å¯¥å¯¥å‡ ä¸ªè€Œå·²ï¼Œå› ä¸ºè¶…è¿‡50%è¿˜æ˜¯å¾ˆéš¾çš„ã€‚

**é’ˆå¯¹ä¸åŒå¤§å°å›¾ç‰‡çš„è¯„æµ‹**

COCOæ•°æ®é›†è¿˜é’ˆå¯¹ ä¸‰ç§ä¸åŒå¤§å°ï¼ˆsmallï¼Œmediumï¼Œlargeï¼‰ çš„å›¾ç‰‡æå‡ºäº†æµ‹é‡æ ‡å‡†ï¼ŒCOCOä¸­åŒ…å«å¤§çº¦ 41% çš„å°ç›®æ ‡ (area<32Ã—32), 34% çš„ä¸­ç­‰ç›®æ ‡ (32Ã—32<area<96Ã—96), å’Œ 24% çš„å¤§ç›®æ ‡ (area>96Ã—96). å°ç›®æ ‡çš„APæ˜¯å¾ˆéš¾æå‡çš„ã€‚

**pycocotools**åŒæ ·ç»™å‡ºä¸Šè¿°è¯„ä»·æ¨¡å‹çš„ä»£ç ã€‚

---

#### ğŸ‰ å‚è€ƒ

[MS COCOæ•°æ®é›†ä»‹ç»ä»¥åŠpycocotoolsç®€å•ä½¿ç”¨](https://blog.csdn.net/qq_37541097/article/details/113247318)
[ç›®æ ‡æ£€æµ‹æ•°æ®é›†MSCOCOç®€ä»‹](https://arleyzhang.github.io/articles/e5b86f16/)